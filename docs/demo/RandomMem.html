<!DOCTYPE html>
<html lang="zh-CN" class="mdui-theme-auto">
    <head>
        <meta charset="utf-8">

        <link rel="shortcut icon" href="../image/logonormal.png" type="image/x-icon">
        <title>FlyGuesWeb</title>

        <link rel="stylesheet" href="https://unpkg.com/mdui@2/mdui.css">
        <script src="https://unpkg.com/mdui@2/mdui.global.js"></script>
        <!-- Filled -->
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <!-- Outlined -->
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
        <!-- Rounded -->
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
        <!-- Sharp -->
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Sharp" rel="stylesheet">
        <!-- Two Tone -->
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Two+Tone" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="../css/font.css">
        <link rel="stylesheet" type="text/css" href="../css/mduiColor.css">


        <style>
        </style>
    </head>
    <body>
      <div style="position: relative">
        <mdui-navigation-rail contained>
          <mdui-navigation-rail-item icon="home--filded" href="../index.html"></mdui-navigation-rail-item>
          <mdui-navigation-rail-item icon="apps--filled" href="../app.html"></mdui-navigation-rail-item>
          <mdui-navigation-rail-item icon="folder--filled" href="../file.html"></mdui-navigation-rail-item>
          <mdui-navigation-rail-item icon="info--filled" href="../info.html"></mdui-navigation-rail-item>
        </mdui-navigation-rail>

        <div style="height:95vh;overflow: auto">
          <div>
            <mdui-top-app-bar style="position: sticky;">
              <mdui-button-icon icon="arrow_back" href="../app.html"></mdui-button-icon>
              <mdui-top-app-bar-title>随机数抽取器</mdui-top-app-bar-title>
              <div style="flex-grow: 1"></div>
    
    
              <mdui-dialog
              close-on-overlay-click
              headline="范围不符合要求"
              class="example-action"
            >
            <mdui-icon slot="icon" name="warning_amber--outlined"></mdui-icon>
            输入有误！<br>
			格式如：1-100，范围必须是0至999999之间的整数。
            <mdui-button slot="action" variant="filled">重试</mdui-button>
            </mdui-dialog>
    
    
            <script>
              const dialog = document.querySelector(".example-action");
              const openButton = dialog.nextElementSibling;
    
              openButton.addEventListener("click", () => dialog.open = true);
    
              const closeButton = dialog.querySelector("mdui-button");
    
              openButton.addEventListener("click", () => dialog.open = true);
              closeButton.addEventListener("click", () => dialog.open = false);
            </script>
    
    
              <mdui-dropdown>
                <mdui-button-icon slot="trigger" icon="more_vert"></mdui-button-icon>
                <mdui-menu>
                  <mdui-menu-item icon="report--outlined" href="mailTo:FlyGues2889@outlook.com?subject=举报项目-RamdomMember&body=我想举报此项目，理由是：">举报</mdui-menu-item>
                  <mdui-menu-item icon="edit--outlined" href="https://github.com/FlyGues2889/FlyGuesWeb">在 GitHub 上编辑</mdui-menu-item>
                </mdui-menu>
              </mdui-dropdown>
            </mdui-top-app-bar>
    
            <style>
              mdui-card.list{
                  padding: 2rem;
                  width: 80%;
                  border-radius: 2rem;
                  margin-bottom: 1rem;
              }
              h4.text{
                padding: 1em;
                padding-left: 0;
                font-weight: bold;
              }
              img.show{
                width: 90%;
              }
            </style>
            <div class="mdui-prose" style="margin: 1rem;width: auto;">
			<center>
				<mdui-card style="
				width: 60%;
				border-radius: 2rem;
				margin-bottom: 1rem;
				">
					<div id="out" style="font-family: 'Product Sans';font-size: 8em;font-weight: bold;padding: 0;">-</div>
					<mdui-divider style="margin-left: 1em;margin-right: 1em;"></mdui-divider>
					<div id="notes">
						<center style="margin: 1em;color: grey;">
							<mdui-icon name="history"></mdui-icon><br>
							<span><small>开始抽取以显示记录</small></span>
						</center>
					</div>
					<mdui-button  id="btn" onclick="getNum()" variant="filled" icon="play_arrow--filled">开始抽取</mdui-button>
					<mdui-button-icon variant="filled" icon="fullscreen" disabled></mdui-button-icon>
				</mdui-card>
			</center>



			<mdui-dialog close-on-overlay-click class="example-header">
				<mdui-top-app-bar slot="header">
				  <mdui-top-app-bar-title>&nbsp;&nbsp;抽取器设置</mdui-top-app-bar-title>
				  <mdui-button-icon icon="close"></mdui-button-icon>
				  
				</mdui-top-app-bar>
				<div style="width: 100%;overflow: hidden;">
					<br>
					<mdui-text-field variant="outlined" label="抽取数字范围" id="num" value="1-55"></mdui-text-field><br/><br>

					时延：<span id="time">0.70</span>秒
					<span id="timeout">
						<mdui-slider nolabel step="250" max="5000" min="250" value="700" class="GETTIME" onchange="tm=false;settime(this.value,0);storage(0)" oninput="tm=true;$('time').innerHTML=(this.value*0.001).toFixed(2)" id="settime"></mdui-slider>
					</span><br>

					<label style="display: flex;align-items: center;">
						<mdui-switch class="manual" id="manual" onclick="manuald();storage(0)">
							<mdui-icon slot="checked-icon" name=""></mdui-icon>
						</mdui-switch>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;是否手动（点击按钮/回车/空格键停止）
					</label><br>

					<div style="display: none;">
						数字颜色（滚动）
						<input type="color" value="#CFCFCF" id="tc" onchange="$('out').style.color=this.value;storage(0)" style="border-radius: 0px;"><br>
	
						数字颜色（抽中）<input type="color" value="#002FA7" id="tsc" onchange="$('out').style.color=this.value;storage(0)" style="border: 0px;"><br><br/>	
					</div>

					<div style="display: flex;align-items: center;">
						<mdui-switch class="toggle"  id="repeat" type="checkbox" value="1" checked="" onchange="if(this.checked)add=[];storage(0)" onclick="if(c){alert('运行中不可设置！');return false}" style="margin: 0;margin-right: 1em;">
							<mdui-icon slot="checked-icon" name=""></mdui-icon>
						</mdui-switch>
						<label for="repeat"></label>
						&nbsp;周期内不重复
					</div>
				</div>
			  </mdui-dialog>
			  
			  <center>
				<mdui-button icon="settings" variant="text">设置</mdui-button>
			  </center>
			  
			  <script>
				const dialog2 = document.querySelector(".example-header");
				const openButton2 = dialog2.nextElementSibling;
				const closeButton2 = dialog2.querySelector("mdui-button-icon");
			  
				openButton2.addEventListener("click", () => dialog2.open = true);
				closeButton2.addEventListener("click", () => dialog2.open = false);
			  </script>
		
          </div>
        </div>
      </div>

	  

      </body>

	  <script>
		const slider = document.querySelector(".GETTIME");
		slider.labelFormatter = (value) => `${value} ms`;
	  </script>
	  <script>
		var c = 0, t, add = [], sec, f = 0, m = 0;
		function $(id) { return document.getElementById(id) }
		function timedCount(numarr) {
			var node = $('out'), rn = Math.floor(Math.random() * (numarr.length));
			node.style.color = $('tc').value;
			node.innerHTML = numarr[rn];
			c = c + 1;
			if (new Date().getTime() - sec > $('settime').value || m) {
				stopCount();
				c = 0;
				m = 0;
				node.style.color = $('tsc').value;
				add.push(numarr[rn]);
				document.querySelector('#notes span').innerHTML = add.join(', ');
				document.querySelector('#notes b').innerHTML = add.length;
			} else
				t = setTimeout("timedCount(numarr)", 50)
		}
		function stopCount() {
			clearTimeout(t)
		}
		function getNum() {
			var manual = $('manual').checked;
			if (c) {
				if (manual) m = 1;
				return;
			}
			m = 0;
			var nr = $('num').value, out = $('out');
			if (sessionStorage.getItem('randomIn') != nr) {
				sessionStorage.setItem('randomIn', nr);
				add = [];
			}
			if (!/^\d{1,6}-\d{1,6}$/.test(nr)) return dialog.open = true;
			arr = nr.split("-");
			a = 0, b = 0;
			var in0 = Number(arr[0]), in1 = Number(arr[1]);
			if (in0 > in1) {
				a = in0;
				b = in1;
			} else if (in1 > in0) {
				a = in1;
				b = in0;
			} else {
				out.innerHTML = in0;
				return
			}
			numarr = [];
			var i = b;
			while (i <= a) {
				if (!$('repeat').checked || add.indexOf(i) == -1)
					numarr.push(i);
				i++;
			}
			if (numarr.length == 0) {
				alert('全部抽取完毕，共计' + add.length + '次。');
				add = [];
				window.removeEventListener("devicemotion", motionEventHandler, false);
				x = y = z = lastX = lastY = lastZ = 0;
				out.style.color = 'black';
				out.innerHTML = '0';
				return;
			}
			sec = new Date().getTime();
			if (manual) sec += 1000 * 60 * 60 * 24 * 7;
			timedCount(numarr)
		}
		document.onkeydown = function (e) {
			var keyCode = window.event ? e.keyCode : e.which;
			if ((13 == keyCode || 32 == keyCode) && f == 0) {
				getNum();
				$('num').blur();
				return false;
			}
		}
		window.onresize = function () {
			var isFull = !!(document.webkitIsFullScreen || document.mozFullScreen || document.msFullscreenElement || document.fullscreenElement);
			var the = $('out').style;
			var T = $('t').style;
			if (isFull == false) {
				the.position = '';
				the.width = '';
				the.height = '';
				the.fontSize = '100px';
				the.lineHeight = '';
				T.display = 'none';
				document.body.parentNode.style.overflow = 'auto';
				window.removeEventListener("devicemotion", motionEventHandler, false);
			} else {
				the.position = 'fixed';
				the.width = '100%';
				the.height = '100%';
				the.fontSize = '28vw';
				the.lineHeight = '100vh';
				the.top = 0;
				the.left = 0;
				the.zIndex = 9;
				T.color = $('ttc').value;
				if ($('boxbtn').checked) T.display = 'block';
				T.zIndex = 10;
				document.body.parentNode.style.overflow = 'hidden';
			}
		}
		function fullScreen(e) {
			e.blur();
			var element = document.documentElement;
			if (element.requestFullscreen) {
				element.requestFullscreen();
			} else if (element.msRequestFullscreen) {
				element.msRequestFullscreen();
			} else if (element.mozRequestFullScreen) {
				element.mozRequestFullScreen();
			} else if (element.webkitRequestFullscreen) {
				element.webkitRequestFullscreen();
			}
			$('t').innerHTML = ($('tips').value).replace(/</g, '&lt;').replace(/\n/g, '<br>');
		}
		var speed = 30, last_update = 0, x = y = z = lastX = lastY = lastZ = 0, zd = sy = 0;
		function motionEventHandler(e) {
			var acceleration = e.accelerationIncludingGravity;
			x = acceleration.x;
			y = acceleration.y;
			z = acceleration.z;
			if (Math.abs(x - lastX) > speed || Math.abs(y - lastY) > speed || Math.abs(z - lastZ) > speed) {
				var curTime = new Date().getTime();
				if (!c && curTime - last_update > 500) {
					last_update = curTime;
					if (sy) $("audio").play();
					if (zd) window.navigator.vibrate(200);
					getNum();
				}
			}
			lastX = x;
			lastY = y;
			lastZ = z;
		}
		var tm = false;
		function settime(vs, vx) {
			if (tm) return;
			setTimeout(function () {
				vx += 50;
				if (vx > vs) vx = vs;
				$('time').innerHTML = (vx * 0.001).toFixed(2);
				if (vx < vs) settime(vs, vx)
			}, 50);
		}
		function storage(n) {
			if (n) {
				if (localStorage.getItem("suijishu")) {
					var settings = JSON.parse(localStorage.getItem("suijishu"));
					if ('settime' in settings) { $('settime').value = settings.settime; settime(settings.settime, 0) }
					if ('bc' in settings) { $('bc').value = settings.bc; $('out').style.backgroundColor = settings.bc }
					if ('tc' in settings) { $('tc').value = settings.tc; $('out').style.color = settings.tc }
					if ('tsc' in settings) $('tsc').value = settings.tsc;
					if ('ttc' in settings) { $('ttc').value = settings.ttc; $('t').style.color = settings.ttc }
					if ('repeat' in settings) $('repeat').checked = (settings.repeat == 1 ? true : false);
					if ('note' in settings) { if (settings.note == 1) { $('note').checked = true; $('notes').style.display = 'block' } else $('note').checked = false }
					if ('manual' in settings) { $('manual').checked = (settings.manual == 1 ? true : false); manuald() }
					if ('position' in settings) { setSelectChecked('position', settings.position); Tposition(settings.position) }
					if ('fs' in settings) { setSelectChecked('fontsize', settings.fs); $('t').style.fontSize = settings.fs + 'px' }
				}
				if ($('settime').value != 700 || $('bc').value != '#ffffff' || $('tc').value != '#000000' || $('tsc').value != '#ff0000' || $('ttc').value != '#000000' || !$('repeat').checked || $('note').checked || $('manual').checked || $('position').selectedIndex != 4 || $('fontsize').selectedIndex != 2)
					$('r').innerHTML = '[<a onclick="defaultValue()">恢复默认</a>]';
				return;
			}
			var setting = new Object();
			setting.settime = $('settime').value;
			setting.bc = $('bc').value;
			setting.tc = $('tc').value;
			setting.tsc = $('tsc').value;
			setting.ttc = $('ttc').value;
			setting.repeat = $('repeat').checked ? 1 : 0;
			setting.note = $('note').checked ? 1 : 0;
			setting.manual = $('manual').checked ? 1 : 0;
			setting.position = $('position').value;
			setting.fs = $('fontsize').value;
			localStorage.setItem("suijishu", JSON.stringify(setting));
		}
		function defaultValue() {
			$('settime').value = 700;
			tm = true;
			setTimeout(function () { tm = false; settime(700, 0) }, 100);
			$('bc').value = '#ffffff';
			$('out').style.backgroundColor = '#ffffff';
			$('tc').value = '#000000';
			$('out').style.color = '#000000';
			$('tsc').value = '#ff0000';
			$('ttc').value = '#000000';
			$('t').style.color = '#000000';
			$('repeat').checked = true;
			$('note').checked = false;
			$('notes').style.display = 'none';
			$('manual').checked = false;
			$('position').selectedIndex = 4;
			$('fontsize').selectedIndex = 2;
			manuald();
			localStorage.removeItem("suijishu");
			$('r').innerHTML = ''
		}
		function manuald() {
			var check = $('manual').checked;
			$('timeout').style.display = check ? 'none' : 'inline-block';
			$('manualtips').style.display = check ? 'inline-block' : 'none';
			if (!check) { m = 0; sec = new Date().getTime() };
		}
		function Tposition(v) {
			$('t').style.cssText = 'position:fixed;display:none;width:100vw;' + (v ? v : $('position').value) + ';font-size:' + $('fontsize').value + 'px';
		}
		function setSelectChecked(id, val) {
			var node = $(id), i = 0;
			for (; i < node.options.length; i++) {
				if (node.options[i].value == val) {
					node.options[i].selected = true;
					break;
				}
			}
		}
	</script>
	
</html>